<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>è´ªåƒè›‡æ¸¸æˆ</title>
    <script type="text/javascript" src="./JS/vue.js"></script>
    <link rel="stylesheet" href="./CSS/style.css" />
  </head>
  <body>
    <div id="app">
      <h1>ğŸ è´ªåƒè›‡æ¸¸æˆ ğŸ</h1>

      <div class="box">
        <span>åˆ†æ•°ï¼š<span id="foodNum">{{ foodNum }}</span></span>
        <span>
          <label for="setSpeed">é€Ÿåº¦ï¼š</label>
          <select id="setSpeed" v-model="speed" @change="setSpeed">
            <option value="150">æ…¢é€Ÿ</option>
            <option value="100">ä¸­é€Ÿ</option>
            <option value="50">å¿«é€Ÿ</option>
          </select>
        </span>
        <span>ç©ºæ ¼é”® å¼€å§‹/æš‚åœ</span>
      </div>

      <div
        class="show"
        v-show="isshow"
        :class="{ pause: result === 'æ¸¸æˆæš‚åœ', running: result === 'æ¸¸æˆè¿›è¡Œä¸­' }"
      >
        {{ result }}
      </div>
      <div class="map-container">
        <table id="map"></table>
      </div>

      <div class="instructions">
        <h3>æ¸¸æˆè¯´æ˜</h3>
        <p>ä½¿ç”¨ â†‘ â†“ â† â†’ æ–¹å‘é”®æ§åˆ¶è›‡çš„ç§»åŠ¨</p>
        <p>æŒ‰ç©ºæ ¼é”®å¼€å§‹/æš‚åœæ¸¸æˆ</p>
        <p>åƒåˆ°çº¢è‰²é£Ÿç‰©å¢åŠ åˆ†æ•°</p>
        <p>æ’åˆ°å¢™å£æˆ–è‡ªèº«æ¸¸æˆç»“æŸ</p>
      </div>
    </div>
    <script type="text/javascript">
      var vm = new Vue({
        el: "#app",
        data: {
          rows: 21, // 21è¡Œ
          cols: 21, // 21åˆ—
          speed: 100, // å‰è¿›é€Ÿåº¦
          curKey: 0, // å½“å‰æ–¹å‘æŒ‰é”®é”®ç å€¼
          timer: 0,
          pos: [], // è›‡èº«ä½ç½®
          foodPos: { x: -1, y: -1 },
          foodNum: -1, // åƒæ‰é£Ÿç‰©æ•°é‡
          dom: null, // åœ°å›¾å…ƒç´ 
          pause: 1, // 1è¡¨ç¤ºæš‚åœï¼Œ-1è¡¨ç¤ºå¼€å§‹
          isshow: false, // æ˜¯å¦æ˜¾ç¤ºæ¸¸æˆæç¤º
          result: "", // æç¤ºä¿¡æ¯
        },

        methods: {
          map: function () {
            // åˆ›å»ºåœ°å›¾
            if (this.dom.firstChild) {
              this.dom.removeChild(this.dom.firstChild); // é‡æ–°å¼€å§‹ï¼Œåˆ é™¤ä¹‹å‰çš„tbody
            }
            for (j = 0; j < this.rows; j++) {
              var tr = this.dom.insertRow(-1); // æ’å…¥ä¸€è¡Œ
              for (i = 0; i < this.cols; i++) {
                tr.insertCell(-1);
              }
            }
          },

          food: function () {
            // ç”Ÿæˆé£Ÿç‰©
            do {
              this.foodPos.y = Math.floor(Math.random() * this.rows);
              this.foodPos.x = Math.floor(Math.random() * this.cols);
            } while (
              this.dom.rows[this.foodPos.y].cells[this.foodPos.x].className !=
              ""
            ); // é˜²æ­¢é£Ÿç‰©ç”Ÿæˆåœ¨è›‡èº«ä¸Š

            this.dom.rows[this.foodPos.y].cells[this.foodPos.x].className =
              "snakefood"; // è®¾ç½®é£Ÿç‰©æ ·å¼
            this.foodNum++; // è®¾ç½®åˆ†æ•°
          },

          init: function () {
            this.map(); // åˆ›å»ºåœ°å›¾
            window.clearInterval(this.timer); // åœæ­¢
            this.pos = [
              { x: 2, y: 0 },
              { x: 1, y: 0 },
              { x: 0, y: 0 },
            ]; // å®šä¹‰è›‡èº«ä½ç½®
            for (var j = 0; j < this.pos.length; j++) {
              // æ˜¾ç¤ºè›‡èº«
              this.dom.rows[this.pos[j].y].cells[this.pos[j].x].className =
                "snakebody";
            }
            this.dom.rows[this.pos[0].y].cells[this.pos[0].x].className =
              "snakehead"; // ä¸ºè›‡å¤´è®¾ç½®æ ·å¼
            this.curKey = 0; // å½“å‰é”®ç å€¼
            this.foodNum = -1; // åƒæ‰çš„é£Ÿç‰©æ•°é‡
            this.food(); // ç”Ÿæˆé£Ÿç‰©
            this.pause = 1; // 1è¡¨ç¤ºæš‚åœï¼Œ-1è¡¨ç¤ºå¼€å§‹
          },

          setSpeed: function (event) {
            event.target.blur(); // ä¸‹æ‹‰èœå•å¤±å»ç„¦ç‚¹
            this.init(); // æ¸¸æˆåˆå§‹åŒ–
            this.isshow = false; // éšè—æ¸¸æˆæç¤º
          },

          trigger: function (event) {
            var _t = this;
            var ekey = event.keyCode; // è·å–é”®ç å€¼
            if (
              ekey >= 37 &&
              ekey <= 40 &&
              ekey != this.curKey &&
              !(
                (this.curKey == 37 && ekey == 39) ||
                (this.curKey == 38 && ekey == 40) ||
                (this.curKey == 39 && ekey == 37) ||
                (this.curKey == 40 && ekey == 38) ||
                this.pause == 1
              )
            ) {
              this.curKey = ekey; // è®¾ç½®å½“å‰æ–¹å‘æŒ‰é”®ç 
            } else if (ekey == 32) {
              this.curKey = this.curKey == 0 ? 39 : this.curKey;
              this.pause *= -1;
              if (this.pause == -1) {
                this.timer = window.setInterval(function () {
                  _t.move();
                }, this.speed); // è›‡èº«ç§»åŠ¨

                this.isshow = true; // æ˜¾ç¤ºæ¸¸æˆæç¤º
                this.result = "æ¸¸æˆè¿›è¡Œä¸­";
              } else {
                window.clearInterval(this.timer); // åœæ­¢
                this.result = "æ¸¸æˆæš‚åœ";
              }
            }

            event.preventDefault();
          },

          move: function () {
            // ç§»åŠ¨
            switch (this.curKey) {
              case 37: // å·¦
                if (this.pos[0].x <= 0) {
                  // è›‡å¤´ç¢°åˆ°è¾¹ç•Œ
                  this.over();
                  return;
                } else {
                  this.pos.unshift({ x: this.pos[0].x - 1, y: this.pos[0].y }); // æ·»åŠ å…ƒç´ 
                }
                break;

              case 38: // ä¸Š
                if (this.pos[0].y <= 0) {
                  // è›‡å¤´ç¢°åˆ°è¾¹ç•Œ
                  this.over();
                  return;
                } else {
                  this.pos.unshift({ x: this.pos[0].x, y: this.pos[0].y - 1 }); // æ·»åŠ å…ƒç´ 
                }
                break;

              case 39: // å³
                if (this.pos[0].x >= this.cols - 1) {
                  // è›‡å¤´ç¢°åˆ°è¾¹ç•Œ
                  this.over();
                  return;
                } else {
                  this.pos.unshift({ x: this.pos[0].x + 1, y: this.pos[0].y }); // æ·»åŠ å…ƒç´ 
                }
                break;

              case 40: // ä¸‹
                if (this.pos[0].y >= this.rows - 1) {
                  // è›‡å¤´ç¢°åˆ°è¾¹ç•Œ
                  this.over();
                  return;
                } else {
                  this.pos.unshift({ x: this.pos[0].x, y: this.pos[0].y + 1 }); // æ·»åŠ å…ƒç´ 
                }
                break;
            }
            if (
              this.pos[0].x == this.foodPos.x &&
              this.pos[0].y == this.foodPos.y
            ) {
              // è›‡å¤´ä½ç½®ä¸é£Ÿç‰©é‡å 
              this.food(); // ç”Ÿæˆé£Ÿç‰©å¹¶åŠ åˆ†
            } else if (this.curKey != 0) {
              this.dom.rows[this.pos[this.pos.length - 1].y].cells[
                this.pos[this.pos.length - 1].x
              ].className = "";
              this.pos.pop(); // åˆ é™¤è›‡å°¾
            }
            for (i = 3; i < this.pos.length; i++) {
              // ä»è›‡çš„ç¬¬4æˆªå¼€å§‹åˆ¤æ–­æ˜¯å¦æ’åˆ°è‡ªå·±
              if (
                this.pos[i].x == this.pos[0].x &&
                this.pos[i].y == this.pos[0].y
              ) {
                this.over(); // æ¸¸æˆç»“æŸ
                return;
              }
            }
            this.dom.rows[this.pos[0].y].cells[this.pos[0].x].className =
              "snakehead"; // ç”»æ–°è›‡å¤´
            this.dom.rows[this.pos[1].y].cells[this.pos[1].x].className =
              "snakebody"; // åŸè›‡å¤´å˜ä¸ºè›‡èº«
          },

          over: function () {
            this.result = "æ¸¸æˆç»“æŸ";
            window.clearInterval(this.timer); // åœæ­¢
            document.onkeydown = null;
            var t = this;
            setTimeout(function () {
              t.isshow = false; // éšè—æ¸¸æˆæç¤º
              t.init(); // é‡ç½®æ¸¸æˆ
              document.onkeydown = function (event) {
                t.trigger(event); // æŒ‰ä¸‹æŒ‰é”®æ—¶è°ƒç”¨æ–¹æ³•
              };
            }, 1500);
          },
        },

        mounted: function () {
          this.dom = document.getElementById("map");
          this.init();
          document.onkeydown = (event) => {
            this.trigger(event);
          };
        },
      });
    </script>
  </body>
</html>
